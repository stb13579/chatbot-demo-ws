<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Parrot Health Chatbot</title>
    <link rel="stylesheet" href="tailwind.css" />
  </head>
  <body class="bg-gray-50 flex items-center justify-center min-h-screen text-gray-900">
    <div id="root"></div>
    <script src="vendor/react.development.js"></script>
    <script src="vendor/react-dom.development.js"></script>
    <script src="vendor/babel.min.js"></script>
    <script type="text/babel">
      function ChatApp() {
        const [messages, setMessages] = React.useState([]);
        const [input, setInput] = React.useState('');
        const [loading, setLoading] = React.useState(false);
        const wsRef = React.useRef(null);

        React.useEffect(() => {
          const protocol = location.protocol === 'https:' ? 'wss' : 'ws';
          wsRef.current = new WebSocket(`${protocol}://${location.host}`);
          wsRef.current.onmessage = (event) => {
            setMessages((msgs) => [...msgs, { from: 'bot', text: event.data }]);
            setLoading(false);
          };
          return () => wsRef.current.close();
        }, []);

          const send = () => {
            if (!input) return;
            wsRef.current.send(input);
            setMessages((msgs) => [...msgs, { from: 'user', text: input }]);
            setInput('');
            setLoading(true);
          };

            return (
          <div className="bg-white shadow-md rounded-lg p-6 w-full max-w-md">
            <h1 className="text-2xl font-bold text-primary-700 mb-4 text-center">Parrot Health Chatbot</h1>
            <img src="parrot.svg" alt="Colorful cartoon parrot standing upright with a cheerful expression, set against a plain background" className="h-16 mx-auto mb-2" />
            <div className="h-64 overflow-y-auto mb-4 border border-gray-200 p-2 rounded">
                {messages.length === 0 ? (
                  <p className="text-gray-500 text-center">Your conversation will appear here.</p>
                ) : (
                  messages.map((m, idx) => (
                    <div key={idx} className={m.from === 'user' ? 'text-right mb-1' : 'text-left mb-1'}>
                      <span className={m.from === 'user' ? 'text-primary-700' : 'text-gray-700'}>
                        {m.from === 'user' ? 'You: ' : ''}{m.text}
                      </span>
                    </div>
                  ))
                )}
                {loading && (
                  <div className="text-left mb-1">
                    <svg className="animate-spin h-5 w-5 text-primary-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
                    </svg>
                  </div>
                )}
              </div>
            <div className="flex">
              <input
                className="flex-grow border border-gray-300 rounded-l px-2 py-1 focus:outline-none"
                placeholder="Type your question here"
                value={input}
                onChange={(e) => setInput(e.target.value)}
                onKeyDown={(e) => { if (e.key === 'Enter') send(); }}
              />
              <button
                className="bg-primary-600 text-white px-4 py-1 rounded-r hover:bg-primary-700 w-20"
                onClick={send}
              >
                Send
              </button>
              
            </div>
            <div className="text-center" style={{ paddingTop: '50px' }}>
                <p className="text-gray-500">You ask questions, we repeat them back to you!</p>
            </div>
          </div>
        );
      }

      ReactDOM.render(<ChatApp />, document.getElementById('root'));
    </script>
  </body>
</html>
